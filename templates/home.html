<!-- Home Page Developed by Me -->
{% extends 'base.html' %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <div class="hero-content zoom-in">
        <h1>Detailed Tracking & <br><span class="highlight">Secure Delivery</span></h1>
        <p>Track your parcel's journey from origin to doorstep with our AI-powered system.</p>

        <div class="cta-group">
            <a href="/track" class="cta-btn primary pulse">üì¶ Track Live</a>
            <a href="/create_parcel" class="cta-btn secondary">üöÄ Send Parcel</a>
        </div>
    </div>
    <div class="hero-visual floating">
        <div class="parcel-3d-icon">üì¶</div>
    </div>
</div>

<!-- Features Section -->
<div class="features-grid">
    <div class="feature-card glass-panel fade-in-delay-1">
        <div class="icon">üìç</div>
        <h3>Live Location</h3>
        <p>See exactly where your parcel is in real-time.</p>
    </div>
    <div class="feature-card glass-panel fade-in-delay-2">
        <div class="icon">üîí</div>
        <h3>Top Security</h3>
        <p>Verified handling with photo proof at every step.</p>
    </div>
    <div class="feature-card glass-panel fade-in-delay-3">
        <div class="icon">ü§ñ</div>
        <h3>AI Support</h3>
        <p>Get instant answers on how to track or ship.</p>
    </div>
</div>

<!-- Feedback Form -->
<div class="feedback-section glass-panel slide-up">
    <h3>üí¨ We Value Your Feedback</h3>
    <form action="/feedback" method="POST" class="feedback-form">
        <input type="email" name="email" placeholder="Your Email" required>
        <textarea name="message" placeholder="Tell us about your experience..." required></textarea>
        <button type="submit" class="cta-btn">Submit Feedback</button>
    </form>
</div>

<!-- Support Chat Widget -->
<div class="ai-chat-widget">
    <div class="chat-bubble" onclick="toggleChat()">
        ü§ñ Need Help?
    </div>
    <div class="chat-window" id="chatWindow" style="display: none;">
        <div class="chat-header">
            <div>
                <strong>TrackSwift AI</strong>
                <span style="font-size: 0.8em; display: block; opacity: 0.8;">Online Support</span>
            </div>
            <span class="close-chat" onclick="toggleChat()">√ó</span>
        </div>

        <div class="chat-body" id="chatBody">
            <div class="msg bot">üëã Hi! I can help you track a parcel or schedule a pickup.</div>

            <!-- Quick Actions -->
            <div class="chips-container">
                <button class="chip" onclick="useChip('Track Parcel')">üì¶ Track Parcel</button>
                <button class="chip" onclick="useChip('Send Package')">üöÄ Send Package</button>
                <button class="chip" onclick="useChip('Contact Support')">üìû Contact Support</button>
            </div>
        </div>

        <div class="chat-input">
            <input type="text" id="userMsg" placeholder="Type a message..." onkeypress="handleChat(event)">
            <button onclick="sendMsg()" class="send-btn">‚û§</button>
        </div>
    </div>
</div>

<style>
    /* Chat Widget Styles */
    .chat-window {
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .chat-body {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        background: rgba(255, 255, 255, 0.05);
    }

    .msg {
        margin-bottom: 8px;
        padding: 8px 12px;
        border-radius: 12px;
        max-width: 80%;
        line-height: 1.4;
        font-size: 0.9em;
        word-wrap: break-word;
    }

    .msg.bot {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        border-bottom-left-radius: 2px;
        align-self: flex-start;
    }

    .msg.user {
        background: var(--primary-color, #ff6b6b);
        color: white;
        border-bottom-right-radius: 2px;
        align-self: flex-end;
        margin-left: auto;
        width: fit-content;
    }

    .chat-link {
        color: #4facfe;
        text-decoration: underline;
    }

    .chips-container {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 10px;
    }

    .chip {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #eee;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.8em;
        cursor: pointer;
        transition: 0.2s;
    }

    .chip:hover {
        background: var(--primary-color, #ff6b6b);
        border-color: var(--primary-color, #ff6b6b);
        color: white;
    }

    .chat-input {
        display: flex;
        padding: 5px;
        background: rgba(0, 0, 0, 0.2);
    }

    .chat-input input {
        flex: 1;
        background: transparent;
        border: none;
        color: white;
        padding: 8px;
        outline: none;
    }

    .send-btn {
        background: none;
        border: none;
        color: var(--primary-color, #ff6b6b);
        font-size: 1.2em;
        cursor: pointer;
        padding: 0 10px;
    }
</style>

<script>
    function toggleChat() {
        var chat = document.getElementById('chatWindow');
        chat.style.display = chat.style.display === 'none' ? 'flex' : 'none';
        if (chat.style.display === 'flex') {
            document.getElementById('userMsg').focus();
        }
    }

    function useChip(text) {
        var input = document.getElementById('userMsg');
        input.value = text;
        sendMsg();
    }

    function handleChat(e) {
        if (e.key === 'Enter') {
            sendMsg();
        }
    }

    function sendMsg() {
        var input = document.getElementById('userMsg');
        var text = input.value.trim();
        if (!text) return;

        var body = document.getElementById('chatBody');

        // Append User Message
        body.innerHTML += '<div class="msg user">' + text + '</div>';
        input.value = '';
        body.scrollTop = body.scrollHeight;

        // Send to API
        fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: text })
        })
            .then(response => response.json())
            .then(data => {
                body.innerHTML += '<div class="msg bot">' + data.reply + '</div>';
                body.scrollTop = body.scrollHeight;
            })
            .catch(err => {
                console.error(err);
                body.innerHTML += '<div class="msg bot">‚ùå Connection error. Please try again.</div>';
            });
    }
</script>

<!-- Developer Attribution Widget -->
<div class="branding-widget" id="brandingWidget">
    <div class="branding-content">
        <span class="close-brand" onclick="hideBrandPermanent()" title="Close">√ó</span>
        <p>Created by <span class="brand-name">Piyush Rasne</span></p>
        <div class="brand-links">
            <a href="https://wa.me/919657265104?text=I%20have%20issue%20add%20help%20detail" target="_blank"
                class="brand-icon whatsapp">WhatsApp</a>
            <a href="https://piyushrasne.great-site.net" target="_blank" class="brand-icon portfolio">üåê Portfolio</a>
        </div>
    </div>
</div>

<script>
    // Visibility Timer
    setTimeout(function () {
        var widget = document.getElementById('brandingWidget');
        if (widget) widget.style.display = 'none';
    }, 10000);

    function hideBrandPermanent() {
        var widget = document.getElementById('brandingWidget');
        if (widget) {
            widget.style.display = 'none';
        }
    }
</script>
{% endblock %}