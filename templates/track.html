<!-- Parcel Tracking Page  -->
{% extends 'base.html' %}
{% block content %}
<div class="tracking-container">
    <h2 class="animated-heading">ğŸ“¦ Track Your Parcel</h2>
    <!-- Tracking Form -->
    <form method="POST" action="/track" class="search-bar animated-form">
        <input type="text" name="tracking_id" placeholder="Enter Tracking ID or Parcel Name" required>
        <button type="submit" class="search-btn">ğŸ” Track</button>
    </form>

    {% if parcel %}


    <!-- Parcel Information -->
    <h3 style="margin-bottom: 15px; color: var(--primary);">Parcel Details</h3>

    <div class="status-card glass-panel swing-in">
        <div
            style="display: flex; flex-direction: column; gap: 15px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;">

            <!-- Tracking ID Display -->
            <div>
                <p
                    style="margin: 0 0 5px 0; font-size: 0.85rem; color: #b3b3b3; text-transform: uppercase; letter-spacing: 0.5px;">
                    Tracking ID</p>
                <div
                    style="color: var(--primary); font-weight: bold; font-family: monospace; font-size: 1.3rem; text-shadow: 0 0 10px rgba(0, 255, 136, 0.3);">
                    {{ parcel.id }}</div>
            </div>

            <!-- Sender & Receiver Information -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <p
                        style="margin: 0 0 5px 0; font-size: 0.85rem; color: #b3b3b3; text-transform: uppercase; letter-spacing: 0.5px;">
                        Sender</p>
                    <h3 style="margin: 0; color: white;">{{ parcel.sender_name }}</h3>
                </div>
                <div>
                    <p
                        style="margin: 0 0 5px 0; font-size: 0.85rem; color: #b3b3b3; text-transform: uppercase; letter-spacing: 0.5px;">
                        Receiver</p>
                    <h3 style="margin: 0; color: white;">{{ parcel.receiver_name }}</h3>
                </div>
            </div>

            <!-- Contact Details -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <p style="margin: 0 0 5px 0; font-size: 0.85rem; color: #b3b3b3;">ğŸ“ Phone</p>
                    <div style="color: white; font-size: 0.95rem;">{{ parcel.phone }}</div>
                </div>
                <div>
                    <p style="margin: 0 0 5px 0; font-size: 0.85rem; color: #b3b3b3;">âœ‰ï¸ Email</p>
                    <div style="color: white; font-size: 0.85rem; word-break: break-all;">{{ parcel.email }}</div>
                </div>
            </div>

            <!-- Current Status -->
            <div>
                <span class="status-badge {{ parcel.status|lower|replace(' ', '-') }}">{{ parcel.status }}</span>
            </div>
        </div>


        <div class="parcel-visuals">
            <!-- Secure Image Display -->
            <span>ğŸ”’ Verified Parcel</span>
            <small>(Image visible to Admin only)</small>
        </div>

        <!-- View on Map Button -->
        <a href="/view_map/{{ parcel.id }}" class="cta-btn primary"
            style="width: 100%; text-align: center; margin-top: 15px; display: block; text-decoration: none;">
            ğŸ—ºï¸ View Journey on Map
        </a>

        <div class="security-info">
            <p>ğŸ”’ <strong>Secure Handling:</strong> Verified by TrackSwift AI Security.</p>
        </div>
    </div>
</div>

<!-- Journey Timeline -->
<div class="timeline-card glass-panel slide-up">
    <h3>ğŸ“ Journey History</h3>
    <ul class="timeline-vertical">
        {% for event in parcel.tracking_history|reverse %}
        <li class="timeline-v-item">
            <div class="v-line"></div>
            <div class="v-dot"></div>
            <div class="v-content">
                <div class="v-header">
                    <span class="v-status">{{ event.status }}</span>
                    <span class="v-time">{{ event.timestamp }}</span>
                </div>
                {% if event.description %}
                <p class="v-desc">{{ event.description }}</p>
                {% endif %}

                <div class="v-loc">
                    {{ event.location }}
                </div>
            </div>
        </li>
        {% else %}
        <li class="timeline-v-item">
            <div class="v-content">
                <h4>Tracking Initiated</h4>
                <p>Waiting for updates...</p>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>



<!-- User Options -->
<div class="actions-card glass-panel fade-in">
    <h3>âš™ï¸ Options</h3>
    <form method="POST" action="/request_change" class="change-form">
        <input type="hidden" name="id" value="{{ parcel.id }}">
        <div class="input-group">
            <input type="text" name="new_address" placeholder="Update Address">
            <input type="text" name="new_phone" placeholder="Update Phone">
        </div>
        <button type="submit" class="action-btn">Request Changes</button>
    </form>
</div>
</div>
{% elif not_found %}
<!-- Error Message -->
<div class="error-panel glass-panel shake">
    <p>âŒ No parcel found with that ID. Please check and try again.</p>
</div>
{% endif %}
</div>
{% endblock %}