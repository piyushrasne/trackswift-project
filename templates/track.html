{% extends 'base.html' %}
{% block content %}
<div class="tracking-container">
    <h2 class="animated-heading">ğŸ“¦ Track Your Parcel</h2>
    <form method="POST" action="/track" class="search-bar animated-form">
        <input type="text" name="tracking_id" placeholder="Enter Tracking ID (e.g. TRK12345)" required>
        <button type="submit" class="search-btn">ğŸ” Track</button>
    </form>

    {% if parcel %}
    <div class="parcel-dashboard">
        <!-- Top Section: Status & Image -->
        <div class="status-card glass-panel swing-in">
            <div class="status-header">
                <h3>{{ parcel.name }}</h3>
                <span class="status-badge {{ parcel.status|lower|replace(' ', '-') }}">{{ parcel.status }}</span>
            </div>

            <div class="parcel-visuals">
                <!-- Image Hidden for Privacy as per Request -->
                <div class="parcel-placeholder secure-mode">
                    <span>ğŸ”’ Verified Parcel</span>
                    <small>(Image visible to Admin only)</small>
                </div>

                <div class="security-info">
                    <p>ğŸ”’ <strong>Secure Handling:</strong> Verified by TrackSwift AI Security.</p>
                </div>
            </div>

            <div class="route-info">
                <div class="point start">
                    <span class="dot"></span>
                    <p class="label">From</p>
                    <p class="addr">{{ parcel.start_address or 'Origin' }}</p>
                </div>
                <div class="line-connector">
                    <div class="progress-line"></div>
                    <i class="truck-icon">ğŸšš</i>
                </div>
                <div class="point end">
                    <span class="dot"></span>
                    <p class="label">To</p>
                    <p class="addr">{{ parcel.end_address or parcel.address }}</p>
                </div>
            </div>
        </div>

        <!-- Timeline Section -->
        <div class="timeline-card glass-panel slide-up">
            <h3>ğŸ“ Journey History</h3>
            <ul class="timeline">
                {% for event in parcel.tracking_history|reverse %}
                <li class="timeline-item">
                    <div class="timestamp">{{ event.timestamp }}</div>
                    <div class="content">
                        <h4>{{ event.status }}</h4>
                        <p>{{ event.location }}</p>
                    </div>
                </li>
                {% else %}
                <li class="timeline-item">
                    <div class="content">
                        <h4>Tracking Initiated</h4>
                        <p>Waiting for updates...</p>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Change Request Section -->
        <div class="actions-card glass-panel fade-in">
            <h3>âš™ï¸ Options</h3>
            <form method="POST" action="/request_change" class="change-form">
                <input type="hidden" name="id" value="{{ parcel.id }}">
                <div class="input-group">
                    <input type="text" name="new_address" placeholder="Update Address">
                    <input type="text" name="new_phone" placeholder="Update Phone">
                </div>
                <button type="submit" class="action-btn">Request Changes</button>
            </form>
        </div>
    </div>
    {% elif not_found %}
    <div class="error-panel glass-panel shake">
        <p>âŒ No parcel found with that ID. Please check and try again.</p>
    </div>
    {% endif %}
</div>
{% endblock %}