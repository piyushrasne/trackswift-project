{% extends 'base.html' %}
{% block content %}
<h2>Admin Dashboard</h2>
<a href="/handle_requests" style="float:right; color:white; text-decoration:none;">
    <span style="font-size:24px;">ðŸ””</span>
    {% if requests_count > 0 %}<span>({{ requests_count }})</span>{% endif %}
</a>

<form method="POST" action="/add_parcel">
    <input type="text" name="id" placeholder="Parcel ID" required>
    <input type="text" name="name" placeholder="Receiver Name" required>
    <input type="text" name="status" placeholder="Status" required>
    <input type="text" name="address" placeholder="Delivery Address" required>
    <input type="text" name="price" placeholder="Price" required>
    <input type="text" name="phone" placeholder="Phone Number" required>
    <input type="email" name="email" placeholder="Email ID" required>
    <select name="payment_type" required>
        <option value="Prepaid">Prepaid</option>
        <option value="Postpaid">Postpaid</option>
    </select>
    <input type="text" name="region" placeholder="Region" required>
    <button type="submit" class="animated-button">Add Parcel</button>
</form>

<div class="filters">
    <input type="text" id="searchInput" placeholder="Search Parcel..." onkeyup="filterTable()">
    <select id="statusFilter" onchange="filterTable()">
        <option value="">All Status</option>
        <option value="pending">Pending</option>
        <option value="shipped">Shipped</option>
        <option value="delivered">Delivered</option>
        <option value="in way">In Way</option>
        <option value="shipping soon">Shipping Soon</option>
    </select>
    <select id="regionFilter" onchange="filterTable()">
        <option value="">All Regions</option>
        <option value="pune">Pune</option>
        <option value="mumbai">Mumbai</option>
        <option value="delhi">Delhi</option>
        <option value="junnar">Junnar</option>
    </select>
    <select id="paymentFilter" onchange="filterTable()">
        <option value="">All Payments</option>
        <option value="Prepaid">Prepaid</option>
        <option value="Postpaid">Postpaid</option>
    </select>
</div>

<h3>All Parcels</h3>
<table id="parcelTable">
    <tr><th>ID</th><th>Name</th><th>Status</th><th>Address</th><th>Price</th><th>Phone</th><th>Email</th><th>Payment</th><th>Region</th><th>Action</th></tr>
    {% for parcel in parcels %}
    <tr>
        <td>{{ parcel.id }}</td>
        <td>{{ parcel.name }}</td>
        <td>{{ parcel.status }}</td>
        <td>{{ parcel.address }}</td>
        <td>{{ parcel.price }}</td>
        <td>{{ parcel.phone }}</td>
        <td>{{ parcel.email }}</td>
        <td>{{ parcel.payment_type }}</td>
        <td>{{ parcel.region }}</td>
        <td>
            <form method="POST" action="/delete_parcel" style="display:inline;">
                <input type="hidden" name="id" value="{{ parcel.id }}">
                <button type="submit" class="animated-button">Delete</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

<script>
function filterTable() {
    var searchInput = document.getElementById("searchInput").value.toUpperCase();
    var statusFilter = document.getElementById("statusFilter").value.toUpperCase();
    var regionFilter = document.getElementById("regionFilter").value.toUpperCase();
    var paymentFilter = document.getElementById("paymentFilter").value.toUpperCase();

    var table = document.getElementById("parcelTable");
    var tr = table.getElementsByTagName("tr");

    for (var i = 1; i < tr.length; i++) {
        var td = tr[i].getElementsByTagName("td");
        var show = true;

        var idNameMatch = td[0].textContent.toUpperCase().includes(searchInput) ||
                          td[1].textContent.toUpperCase().includes(searchInput);

        var statusMatch = statusFilter === "" || td[2].textContent.toUpperCase() === statusFilter;
        var regionMatch = regionFilter === "" || td[8].textContent.toUpperCase() === regionFilter;
        var paymentMatch = paymentFilter === "" || td[7].textContent.toUpperCase() === paymentFilter;

        if (!(idNameMatch && statusMatch && regionMatch && paymentMatch)) {
            show = false;
        }

        tr[i].style.display = show ? "" : "none";
    }
}
</script>

<style>
.filters {
    margin: 20px 0;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}
.filters select, .filters input {
    padding: 10px;
    border-radius: 6px;
    border: none;
}
</style>
{% endblock %}
